<!DOCTYPE html>
<html>
<head>
    <title>MBTIæµ‹è¯•ä¸æ¯æ—¥æ¿€åŠ±</title>
    <style>
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question-number {
            color: #666;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background-color: #f5f5f5;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .option-btn:hover {
            background-color: #007AFF;
            color: white;
        }

        .result-container {
            text-align: center;
            padding: 40px 0;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-btn {
            padding: 10px 20px;
            background-color: #007AFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .quote-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .quote-text {
            font-size: 18px;
            font-style: italic;
            color: #333;
            margin-bottom: 10px;
        }

        .mbti-type {
            color: #666;
            margin-bottom: 20px;
        }

        .input-section {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .input-section input {
            width: 200px;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
            margin: 20px auto;
        }

        .action-btn {
            padding: 15px 20px;
            background-color: #007AFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .action-btn:hover {
            background-color: #0056b3;
        }

        .time-message {
            color: #007AFF;
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .quote-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .chat-button {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background-color: #007AFF;
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: transform 0.2s;
            user-select: none;
        }

        .chat-button:hover {
            transform: scale(1.1);
        }

        .chat-button:active {
            transform: scale(0.95);
        }

        .chat-container {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            overflow: hidden;
            transition: opacity 0.3s, transform 0.3s;
        }

        .chat-header {
            padding: 15px;
            background: #007AFF;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 10px;
            max-width: 80%;
        }

        .user-message {
            margin-left: auto;
            background: #007AFF;
            color: white;
            padding: 8px 12px;
            border-radius: 15px 15px 0 15px;
        }

        .bot-message {
            margin-right: auto;
            background: #f0f0f0;
            padding: 8px 12px;
            border-radius: 15px 15px 15px 0;
        }

        .chat-input-container {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .chat-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-action-btn:hover {
            background: #e0e0e0;
        }

        /* ç¡®ä¿ chat-wrapper å§‹ç»ˆæ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚ */
        #chat-wrapper {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            pointer-events: auto;
        }

        .loading {
            position: relative;
            min-width: 30px;
            min-height: 20px;
        }

        .loading::after {
            content: '...';
            position: absolute;
            animation: loading 1s infinite;
        }

        @keyframes loading {
            0% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }

        .recording {
            background-color: #ff4444 !important;
            color: white !important;
        }

        .message img {
            max-width: 200px;
            border-radius: 8px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <!-- èŠå¤©ç»„ä»¶ -->
    <div id="chat-wrapper">
        <button class="chat-button" onclick="toggleChat()">ğŸ’¬</button>
        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                <span id="aiAssistantName">AI åŠ©æ‰‹</span>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; cursor: pointer;">âœ•</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- æ¶ˆæ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
            <div class="chat-input-container">
                <div class="chat-actions">
                    <button class="chat-action-btn" onclick="toggleVoiceInput()" title="è¯­éŸ³è¾“å…¥">ğŸ¤</button>
                    <button class="chat-action-btn" onclick="uploadFile()" title="ä¸Šä¼ æ–‡ä»¶">ğŸ“</button>
                    <button class="chat-action-btn" onclick="uploadImage()" title="ä¸Šä¼ å›¾ç‰‡">ğŸ–¼ï¸</button>
                </div>
                <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeypress="handleKeyPress(event)">
                <button class="chat-action-btn" onclick="sendMessage()" title="å‘é€">â¤</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ éšè—çš„æ–‡ä»¶ä¸Šä¼ è¾“å…¥ -->
    <input type="file" id="fileInput" style="display: none" onchange="handleFileUpload(event)">
    <input type="file" id="imageInput" accept="image/*" style="display: none" onchange="handleImageUpload(event)">

    <div class="container">
        <div class="header">
            <h1>MBTIæµ‹è¯•ä¸æ¯æ—¥æ¿€åŠ±</h1>
        </div>
        <div id="main-container">
            <div class="action-buttons">
                <button class="action-btn" onclick="showInputSection()">å·²çŸ¥MBTIç±»å‹</button>
                <button class="action-btn" onclick="showTestSection()">å¼€å§‹MBTIæµ‹è¯•</button>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            {
                id: 1,
                text: "åœ¨ç¤¾äº¤åœºåˆä¸­ï¼Œä½ é€šå¸¸ä¼šï¼š",
                options: [
                    { value: "E", text: "ä¸»åŠ¨ä¸ä»–äººäº¤è°ˆï¼Œæ„Ÿåˆ°èƒ½é‡å……æ²›" },
                    { value: "I", text: "å€¾å‘äºå®‰é™è§‚å¯Ÿï¼Œè§‰å¾—ç¤¾äº¤æ¶ˆè€—èƒ½é‡" }
                ]
            },
            {
                id: 2,
                text: "åœ¨è·å–ä¿¡æ¯æ—¶ï¼Œä½ æ›´å€¾å‘äºï¼š",
                options: [
                    { value: "S", text: "å…³æ³¨å…·ä½“çš„ç»†èŠ‚å’Œäº‹å®" },
                    { value: "N", text: "å…³æ³¨æ¦‚å¿µå’Œå¯èƒ½æ€§" }
                ]
            },
            {
                id: 3,
                text: "åšå†³å®šæ—¶ï¼Œä½ é€šå¸¸ä¼šï¼š",
                options: [
                    { value: "T", text: "ä¾æ®é€»è¾‘å’Œå®¢è§‚åˆ†æ" },
                    { value: "F", text: "è€ƒè™‘ä»–äººæ„Ÿå—å’Œä»·å€¼è§‚" }
                ]
            },
            {
                id: 4,
                text: "åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œä½ æ›´å–œæ¬¢ï¼š",
                options: [
                    { value: "J", text: "æŒ‰è®¡åˆ’è¡Œäº‹ï¼Œå–œæ¬¢ç¡®å®šæ€§" },
                    { value: "P", text: "ä¿æŒçµæ´»ï¼Œéšæœºåº”å˜" }
                ]
            }
        ];

        let currentQuestionIndex = 0;
        let answers = new Array(questions.length).fill('');

        function showQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('main-container');

            if (currentQuestionIndex >= questions.length) {
                showResult();
                return;
            }

            container.innerHTML = `
                <div class="question-container">
                    <div class="question-number">é—®é¢˜ ${currentQuestionIndex + 1}/${questions.length}</div>
                    <div class="question-text">${question.text}</div>
                    <div class="options-container">
                        ${question.options.map(option => `
                            <button class="option-btn" onclick="selectAnswer('${option.value}')">
                                ${option.text}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function selectAnswer(value) {
            answers[currentQuestionIndex] = value;
            currentQuestionIndex++;
            showQuestion();
        }

        function calculateResult() {
            let mbtiResult = '';
            
            // E/I
            const eCount = answers.filter(a => a === 'E').length;
            mbtiResult += eCount > answers.length/8 ? 'E' : 'I';
            
            // S/N
            const sCount = answers.filter(a => a === 'S').length;
            mbtiResult += sCount > answers.length/8 ? 'S' : 'N';
            
            // T/F
            const tCount = answers.filter(a => a === 'T').length;
            mbtiResult += tCount > answers.length/8 ? 'T' : 'F';
            
            // J/P
            const jCount = answers.filter(a => a === 'J').length;
            mbtiResult += jCount > answers.length/8 ? 'J' : 'P';

            return mbtiResult;
        }

        const motivationalQuotes = {
            INTJ: {
                morning: [
                    "æ–°çš„ä¸€å¤©ï¼Œç”¨æˆ˜ç•¥æ€§æ€ç»´è§„åˆ’ä½ çš„ç›®æ ‡ã€‚",
                    "æ—©å®‰ï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºæœ€é‡è¦çš„ä»»åŠ¡ã€‚",
                    "æ¸…æ™¨æ˜¯æ€è€ƒå’Œè®¡åˆ’çš„æœ€ä½³æ—¶åˆ»ã€‚"
                ],
                noon: [
                    "åœä¸‹æ¥å®¡è§†ä½ çš„è¿›åº¦ï¼Œè°ƒæ•´æ¥ä¸‹æ¥çš„è®¡åˆ’ã€‚",
                    "åˆä¼‘æ—¶åˆ»ï¼Œè®©å¤§è„‘çŸ­æš‚æ”¾æ¾ï¼Œç„¶åç»§ç»­å‰è¿›ã€‚",
                    "è®°å¾—åœ¨å·¥ä½œé—´éš™ç•™å‡ºæ—¶é—´æ€è€ƒã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©çš„æ”¶è·ï¼Œä¸ºæ˜å¤©åšå¥½å‡†å¤‡ã€‚",
                    "æ„Ÿè°¢ä»Šå¤©çš„æ¯ä¸ªå†³å®šï¼Œå®ƒä»¬éƒ½åœ¨å¡‘é€ æ›´å¥½çš„ä½ ã€‚",
                    "æ™šä¸Šæ˜¯æ€»ç»“ç»éªŒçš„å¥½æ—¶æœºã€‚"
                ]
            },
            INTP: {
                morning: [
                    "æ—©å®‰ï¼Œè®©å¥½å¥‡å¿ƒå¼•é¢†æ–°çš„ä¸€å¤©ã€‚",
                    "ç”¨åˆ›æ–°çš„æ€ç»´å¼€å¯ä»Šå¤©çš„æ¢ç´¢ã€‚",
                    "æ–°çš„ä¸€å¤©ï¼Œæ–°çš„å‘ç°ç­‰ç€ä½ ã€‚"
                ],
                noon: [
                    "åˆä¼‘æ—¶åˆ»ï¼Œè®©æ€ç»´æ²‰æ·€ä¸€ä¸‹ã€‚",
                    "ç¨ä½œä¼‘æ¯ï¼Œè®©åˆ›æ„ç»§ç»­å‘é…µã€‚",
                    "ç»™è‡ªå·±ä¸€ç‚¹æ—¶é—´æ•´ç†ä¸Šåˆçš„æƒ³æ³•ã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©çš„æ€è€ƒæ”¶è·ã€‚",
                    "æ„Ÿè°¢ä»Šå¤©é‡åˆ°çš„æ¯ä¸ªæœ‰è¶£é—®é¢˜ã€‚",
                    "æ€»ç»“ä»Šå¤©çš„å‘ç°ï¼ŒæœŸå¾…æ˜å¤©çš„æ¢ç´¢ã€‚"
                ]
            },
            ENTJ: {
                morning: [
                    "æ—©å®‰ï¼Œé¢†å¯¼è€…ï¼æ–°çš„ä¸€å¤©ç­‰å¾…ä½ çš„æŒ‡æŒ¥ã€‚",
                    "åˆ¶å®šä»Šå¤©çš„ç›®æ ‡ï¼Œå¸¦é¢†å›¢é˜Ÿå‰è¿›ã€‚",
                    "æ¸…æ™¨æ˜¯è§„åˆ’å’Œéƒ¨ç½²çš„æœ€ä½³æ—¶æœºã€‚"
                ],
                noon: [
                    "æ£€è§†ä¸Šåˆçš„è¿›åº¦ï¼Œè°ƒæ•´ä¸‹åˆçš„ç­–ç•¥ã€‚",
                    "é€‚å½“ä¼‘æ¯ï¼Œä¿æŒæœ€ä½³å†³ç­–çŠ¶æ€ã€‚",
                    "åˆ©ç”¨åˆä¼‘æ—¶é—´æ€è€ƒé‡è¦å†³ç­–ã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©çš„æˆæœï¼Œè§„åˆ’æ˜å¤©çš„ç›®æ ‡ã€‚",
                    "æ„Ÿè°¢å›¢é˜Ÿçš„ä»˜å‡ºï¼Œä¸ºæ˜å¤©åšå¥½å‡†å¤‡ã€‚",
                    "æ€»ç»“ä»Šå¤©çš„ç»éªŒï¼Œæ˜å¤©ä¼šæ›´å¥½ã€‚"
                ]
            },
            ENTP: {
                morning: [
                    "æ—©å®‰ï¼Œåˆ›æ–°è€…ï¼æ–°çš„æƒ³æ³•åœ¨ç­‰ç€ä½ ã€‚",
                    "è®©æˆ‘ä»¬ç”¨æ–°è§†è§’å¼€å¯ä»Šå¤©ã€‚",
                    "æ—©æ™¨æ˜¯å¤´è„‘é£æš´çš„æœ€ä½³æ—¶åˆ»ã€‚"
                ],
                noon: [
                    "æš‚åœæ€è€ƒï¼Œè®©åˆ›æ„æ²‰æ·€ã€‚",
                    "æ¢ä¸ªè§’åº¦çœ‹å¾…ä¸Šåˆçš„å‘ç°ã€‚",
                    "ä¼‘æ¯ç‰‡åˆ»ï¼Œå‡†å¤‡ä¸‹åˆçš„åˆ›æ–°ã€‚"
                ],
                evening: [
                    "æ•´ç†ä»Šå¤©çš„çµæ„Ÿï¼ŒæœŸå¾…æ˜å¤©çš„å¯èƒ½ã€‚",
                    "æ„Ÿè°¢ä»Šå¤©é‡åˆ°çš„æ¯ä¸ªæŒ‘æˆ˜ã€‚",
                    "è®©æˆ‘ä»¬æœŸå¾…æ˜å¤©çš„æ–°å‘ç°ã€‚"
                ]
            },
            ENFJ: {
                morning: [
                    "æ—©å®‰ï¼Œæ¿€åŠ±è€…ï¼å‡†å¤‡å»æ¸©æš–ä»–äººçš„å¿ƒã€‚",
                    "æ–°çš„ä¸€å¤©ï¼Œæ–°çš„æœºä¼šå»å¸®åŠ©ä»–äººã€‚",
                    "ç”¨ä½ çš„çƒ­æƒ…ç‚¹äº®è¿™ä¸ªæ—©æ™¨ã€‚"
                ],
                noon: [
                    "ä¼‘æ¯ç‰‡åˆ»ï¼Œç»§ç»­ä¼ é€’æ¸©æš–ã€‚",
                    "è°ƒæ•´çŠ¶æ€ï¼Œä¿æŒç§¯æèƒ½é‡ã€‚",
                    "åˆä¼‘æ—¶åˆ»ï¼Œå…³å¿ƒä¸€ä¸‹è‡ªå·±ã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©å¸®åŠ©è¿‡çš„äººä»¬ã€‚",
                    "æ„Ÿæ©ä»Šå¤©çš„æ¯æ¬¡äº’åŠ¨ã€‚",
                    "ä¸ºæ˜å¤©çš„æ¸©æš–ç›¸é‡åšå‡†å¤‡ã€‚"
                ]
            },
            ENFP: {
                morning: [
                    "æ—©å®‰ï¼Œæ¢¦æƒ³å®¶ï¼æ–°çš„å†’é™©ç­‰ç€ä½ ã€‚",
                    "è®©æˆ‘ä»¬ç”¨çƒ­æƒ…æ‹¥æŠ±è¿™ä¸€å¤©ã€‚",
                    "ä»Šå¤©ä¼šæœ‰ä»¤äººå…´å¥‹çš„å‘ç°ã€‚"
                ],
                noon: [
                    "äº«å—åˆä¼‘æ—¶å…‰ï¼Œè¡¥å……èƒ½é‡ã€‚",
                    "æ”¾æ¾å¿ƒæƒ…ï¼Œä¿æŒåˆ›é€ åŠ›ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„ç²¾å½©æ—¶åˆ»ã€‚"
                ],
                evening: [
                    "æ„Ÿè°¢ä»Šå¤©çš„æ¯ä¸ªç²¾å½©ç¬é—´ã€‚",
                    "å›é¡¾ä»Šå¤©çš„å¿«ä¹æ—¶å…‰ã€‚",
                    "å¸¦ç€æœŸå¾…å…¥ç¡ï¼Œæ˜å¤©ç»§ç»­å†’é™©ã€‚"
                ]
            },
            ESTJ: {
                morning: [
                    "æ—©å®‰ï¼Œæ‰§è¡Œè€…ï¼å¼€å§‹é«˜æ•ˆçš„ä¸€å¤©ã€‚",
                    "æŒ‰è®¡åˆ’è¡Œäº‹ï¼Œç¡®ä¿ç›®æ ‡è¾¾æˆã€‚",
                    "æ–°çš„ä¸€å¤©ï¼Œæ–°çš„ä»»åŠ¡ç­‰å¾…å®Œæˆã€‚"
                ],
                noon: [
                    "æ£€æŸ¥ä¸Šåˆçš„å®Œæˆåº¦ï¼Œè§„åˆ’ä¸‹åˆã€‚",
                    "åˆç†ä¼‘æ¯ï¼Œä¿æŒæ‰§è¡ŒåŠ›ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„å·¥ä½œå®‰æ’ã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©çš„å®Œæˆæƒ…å†µã€‚",
                    "ä¸ºæ˜å¤©åšå¥½å‡†å¤‡å’Œè®¡åˆ’ã€‚",
                    "æ€»ç»“ç»éªŒï¼ŒæœŸå¾…æ›´æœ‰æ•ˆç‡çš„æ˜å¤©ã€‚"
                ]
            },
            ESFJ: {
                morning: [
                    "æ—©å®‰ï¼Œå…³æ€€è€…ï¼å‡†å¤‡ä¼ é€’æ¸©æš–ã€‚",
                    "æ–°çš„ä¸€å¤©ï¼Œæ–°çš„æœºä¼šå…³å¿ƒä»–äººã€‚",
                    "ç”¨å–„æ„å¼€å¯ç¾å¥½çš„ä¸€å¤©ã€‚"
                ],
                noon: [
                    "ç…§é¡¾å¥½è‡ªå·±ï¼Œç»§ç»­å…³çˆ±ä»–äººã€‚",
                    "äº«å—åˆä¼‘ï¼Œè¡¥å……å…³æ€€èƒ½é‡ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„æš–å¿ƒæ—¶åˆ»ã€‚"
                ],
                evening: [
                    "æ„Ÿæ©ä»Šå¤©å¸®åŠ©è¿‡çš„æ¯ä¸ªäººã€‚",
                    "å›é¡¾ä»Šå¤©çš„æ¸©æš–æ—¶åˆ»ã€‚",
                    "å¸¦ç€çˆ±å¿ƒå…¥ç¡ï¼Œæ˜å¤©ç»§ç»­ä»˜å‡ºã€‚"
                ]
            },
            ESTP: {
                morning: [
                    "æ—©å®‰ï¼Œå†’é™©å®¶ï¼æ–°çš„æŒ‘æˆ˜ç­‰ç€ä½ ã€‚",
                    "å‡†å¤‡å¥½è¿æ¥åˆºæ¿€çš„ä¸€å¤©ã€‚",
                    "ä»Šå¤©å°†å……æ»¡è¡ŒåŠ¨å’Œæœºé‡ã€‚"
                ],
                noon: [
                    "è¡¥å……èƒ½é‡ï¼Œå‡†å¤‡ä¸‹åˆçš„æŒ‘æˆ˜ã€‚",
                    "çŸ­æš‚ä¼‘æ¯ï¼Œä¿æŒæ•é”ç›´è§‰ã€‚",
                    "è°ƒæ•´çŠ¶æ€ï¼Œè¿æ¥æ–°çš„æœºä¼šã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©çš„ç²¾å½©æ—¶åˆ»ã€‚",
                    "æ„Ÿè°¢ä»Šå¤©çš„æ¯æ¬¡å†’é™©ã€‚",
                    "æœŸå¾…æ˜å¤©çš„æ–°æŒ‘æˆ˜ã€‚"
                ]
            },
            ESFP: {
                morning: [
                    "æ—©å®‰ï¼Œè¡¨æ¼”è€…ï¼è®©æˆ‘ä»¬å¼€å§‹ç²¾å½©çš„ä¸€å¤©ã€‚",
                    "ç”¨æ¬¢ä¹ç‚¹äº®è¿™ä¸ªæ—©æ™¨ã€‚",
                    "å‡†å¤‡å¥½äº«å—ä»Šå¤©çš„å¿«ä¹æ—¶å…‰ã€‚"
                ],
                noon: [
                    "äº«å—åˆä¼‘çš„æ¬¢ä¹æ—¶å…‰ã€‚",
                    "è¡¥å……èƒ½é‡ï¼Œç»§ç»­æ•£æ’­å¿«ä¹ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„ç²¾å½©è¡¨ç°ã€‚"
                ],
                evening: [
                    "æ„Ÿè°¢ä»Šå¤©çš„æ¬¢ä¹æ—¶å…‰ã€‚",
                    "å›é¡¾ä»Šå¤©å¸¦ç»™ä»–äººçš„å¾®ç¬‘ã€‚",
                    "å¸¦ç€å¿«ä¹å…¥ç¡ï¼ŒæœŸå¾…æ˜å¤©çš„ç²¾å½©ã€‚"
                ]
            },
            ISTJ: {
                morning: [
                    "æ—©å®‰ï¼Œå®ˆæŠ¤è€…ï¼æ–°çš„ä¸€å¤©éœ€è¦ä½ çš„ä¸“æ³¨ã€‚",
                    "æŒ‰éƒ¨å°±ç­ï¼Œç¨³æ­¥å®Œæˆä»Šå¤©çš„ä»»åŠ¡ã€‚",
                    "ç”¨å¯é çš„æ€åº¦å¼€å¯å……å®çš„ä¸€å¤©ã€‚"
                ],
                noon: [
                    "æ£€æŸ¥ä¸Šåˆçš„å·¥ä½œæˆæœã€‚",
                    "é€‚åº¦ä¼‘æ¯ï¼Œä¿æŒæœ€ä½³çŠ¶æ€ã€‚",
                    "ä¸ºä¸‹åˆçš„å·¥ä½œåšå¥½å‡†å¤‡ã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©çš„å®Œæˆæƒ…å†µã€‚",
                    "æ„Ÿè°¢è‡ªå·±çš„åšæŒå’Œä»˜å‡ºã€‚",
                    "æ•´ç†æ€ç»ªï¼Œå‡†å¤‡æ˜å¤©çš„è®¡åˆ’ã€‚"
                ]
            },
            ISFJ: {
                morning: [
                    "æ—©å®‰ï¼Œå®ˆæŠ¤è€…ï¼å‡†å¤‡å»å…³çˆ±ä»–äººã€‚",
                    "ç”¨ç»†å¿ƒå’Œè€å¿ƒå¼€å¯æ–°çš„ä¸€å¤©ã€‚",
                    "ä»Šå¤©ä¹Ÿè¦ç»§ç»­æ¸©æš–ä»–äººã€‚"
                ],
                noon: [
                    "ç…§é¡¾ä»–äººçš„åŒæ—¶ä¹Ÿè¦ç…§é¡¾è‡ªå·±ã€‚",
                    "äº«å—ç‰‡åˆ»å®é™ï¼Œè¡¥å……èƒ½é‡ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„å…³æ€€æ—¶å…‰ã€‚"
                ],
                evening: [
                    "æ„Ÿæ©ä»Šå¤©ä»˜å‡ºçš„æ¯ä¸€åˆ»ã€‚",
                    "å›é¡¾ä»Šå¤©å¸®åŠ©è¿‡çš„äººã€‚",
                    "å¸¦ç€æ¸©æš–çš„å¿ƒå…¥ç¡ã€‚"
                ]
            },
            ISTP: {
                morning: [
                    "æ—©å®‰ï¼ŒåŒ äººï¼æ–°çš„æŒ‘æˆ˜ç­‰å¾…è§£å†³ã€‚",
                    "ç”¨çµæ´»çš„æ€ç»´è¿æ¥æ–°çš„ä¸€å¤©ã€‚",
                    "ä¿æŒä¸“æ³¨ï¼Œäº«å—åŠ¨æ‰‹çš„è¿‡ç¨‹ã€‚"
                ],
                noon: [
                    "æ£€æŸ¥ä¸Šåˆçš„è¿›å±•ã€‚",
                    "è°ƒæ•´çŠ¶æ€ï¼Œä¿æŒæ•é”ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„å®è·µæ—¶å…‰ã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©è§£å†³çš„é—®é¢˜ã€‚",
                    "æ„Ÿè°¢ä»Šå¤©çš„æ¯æ¬¡å°è¯•ã€‚",
                    "æ•´ç†å·¥å…·ï¼ŒæœŸå¾…æ˜å¤©çš„æŒ‘æˆ˜ã€‚"
                ]
            },
            ISFP: {
                morning: [
                    "æ—©å®‰ï¼Œè‰ºæœ¯å®¶ï¼è®©çµæ„ŸæŒ‡å¼•æ–°çš„ä¸€å¤©ã€‚",
                    "ç”¨ç‹¬ç‰¹çš„è§†è§’æ„Ÿå—è¿™ä¸ªä¸–ç•Œã€‚",
                    "ä¿æŒçœŸæˆ‘ï¼Œäº«å—åˆ›ä½œçš„è¿‡ç¨‹ã€‚"
                ],
                noon: [
                    "äº«å—åˆåçš„è‰ºæœ¯æ—¶å…‰ã€‚",
                    "æ”¾æ¾å¿ƒæƒ…ï¼Œè®©çµæ„Ÿç»§ç»­æµåŠ¨ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„åˆ›æ„æ—¶åˆ»ã€‚"
                ],
                evening: [
                    "æ„Ÿå—ä»Šå¤©çš„ç¾å¥½ç¬é—´ã€‚",
                    "å›é¡¾ä»Šå¤©çš„è‰ºæœ¯çµæ„Ÿã€‚",
                    "å¸¦ç€åˆ›æ„å…¥ç¡ï¼ŒæœŸå¾…æ˜å¤©çš„çµæ„Ÿã€‚"
                ]
            },
            INFJ: {
                morning: [
                    "æ—©å®‰ï¼Œç†æƒ³ä¸»ä¹‰è€…ï¼æ–°çš„ä¸€å¤©ç­‰å¾…ä½ çš„æ´å¯Ÿã€‚",
                    "ç”¨ç‹¬ç‰¹çš„è§†è§’æ„Ÿå—è¿™ä¸ªä¸–ç•Œã€‚",
                    "è®©ç›´è§‰å¼•å¯¼ä½ çš„æ–¹å‘ã€‚"
                ],
                noon: [
                    "åœä¸‹æ¥ï¼Œå€¾å¬å†…å¿ƒçš„å£°éŸ³ã€‚",
                    "è°ƒæ•´èƒ½é‡ï¼Œä¿æŒå†…åœ¨å¹³é™ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„æ·±åº¦æ€è€ƒã€‚"
                ],
                evening: [
                    "å›é¡¾ä»Šå¤©çš„å¿ƒçµæ„Ÿæ‚Ÿã€‚",
                    "æ„Ÿæ©ä»Šå¤©çš„æ¯æ¬¡é¢†æ‚Ÿã€‚",
                    "å¸¦ç€å¹³é™å…¥ç¡ï¼ŒæœŸå¾…æ˜å¤©çš„å¯ç¤ºã€‚"
                ]
            },
            INFP: {
                morning: [
                    "æ—©å®‰ï¼Œæ²»æ„ˆè€…ï¼è®©æ¸©æŸ”å¼€å¯æ–°çš„ä¸€å¤©ã€‚",
                    "ç”¨å–„æ„çš„å¿ƒæ„Ÿå—è¿™ä¸ªä¸–ç•Œã€‚",
                    "ä¿æŒç†æƒ³ä¸»ä¹‰çš„ä¿¡å¿µã€‚"
                ],
                noon: [
                    "äº«å—ç‹¬å¤„çš„æ—¶å…‰ã€‚",
                    "è®©å¿ƒçµå¾—åˆ°ä¼‘æ¯å’Œæ»‹å…»ã€‚",
                    "å‡†å¤‡ä¸‹åˆçš„å¿ƒçµä¹‹æ—…ã€‚"
                ],
                evening: [
                    "æ„Ÿæ©ä»Šå¤©è§¦åŠ¨å¿ƒçµçš„æ—¶åˆ»ã€‚",
                    "å›é¡¾ä»Šå¤©çš„æƒ…æ„Ÿä½“éªŒã€‚",
                    "å¸¦ç€æ¸©æš–çš„å¿ƒç­‰å¾…æ˜å¤©ã€‚"
                ]
            }
        };

        function getRandomQuote(mbtiType) {
            const hour = new Date().getHours();
            let timeOfDay;
            
            if (hour >= 5 && hour < 11) {
                timeOfDay = 'morning';
            } else if (hour >= 11 && hour < 17) {
                timeOfDay = 'noon';
            } else {
                timeOfDay = 'evening';
            }

            const defaultQuotes = {
                morning: [
                    "æ—©å®‰ï¼æ–°çš„ä¸€å¤©å……æ»¡å¯èƒ½ã€‚",
                    "è¿æ¥å´­æ–°çš„ä¸€å¤©ã€‚",
                    "è®©æˆ‘ä»¬ä»¥ç§¯æçš„å¿ƒæ€å¼€å§‹ä»Šå¤©ã€‚"
                ],
                noon: [
                    "ä¸­åˆå¥½ï¼ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­åŠ æ²¹ã€‚",
                    "è®°å¾—ç»™è‡ªå·±ä¸€ç‚¹ä¼‘æ¯æ—¶é—´ã€‚",
                    "è¡¥å……èƒ½é‡ï¼Œå‡†å¤‡ä¸‹åˆçš„æŒ‘æˆ˜ã€‚"
                ],
                evening: [
                    "æ™šä¸Šå¥½ï¼å›é¡¾ä»Šå¤©çš„æ”¶è·ã€‚",
                    "æ„Ÿæ©ä»Šå¤©é‡åˆ°çš„æ¯ä¸ªäººå’Œäº‹ã€‚",
                    "æ”¾æ¾å¿ƒæƒ…ï¼Œå‡†å¤‡è¿æ¥æ˜å¤©ã€‚"
                ]
            };

            const quotes = motivationalQuotes[mbtiType]?.[timeOfDay] || defaultQuotes[timeOfDay];
            const randomIndex = Math.floor(Math.random() * quotes.length);
            return quotes[randomIndex];
        }

        function showTestSection() {
            currentQuestionIndex = 0;
            answers = new Array(questions.length).fill('');
            showQuestion();
        }

        function showQuoteSection() {
            const container = document.getElementById('main-container');
            const savedMbtiType = localStorage.getItem('mbtiType') || '';
            const quote = getRandomQuote(savedMbtiType);
            const hour = new Date().getHours();
            let timeMessage;
            
            if (hour >= 5 && hour < 11) {
                timeMessage = "æ—©å®‰ï¼å¼€å¯ç¾å¥½çš„ä¸€å¤©";
            } else if (hour >= 11 && hour < 17) {
                timeMessage = "åˆå¥½ï¼ç»§ç»­åŠ æ²¹";
            } else {
                timeMessage = "æ™šå¥½ï¼å›é¡¾ä»Šå¤©çš„æ”¶è·";
            }
            
            container.innerHTML = `
                <div class="quote-container">
                    ${savedMbtiType ? `<div class="mbti-type">æ‚¨çš„MBTIç±»å‹ï¼š${savedMbtiType}</div>` : ''}
                    <div class="time-message">${timeMessage}</div>
                    <div class="quote-text">"${quote}"</div>
                    <button class="option-btn" onclick="showNewQuote()">æ¢ä¸€æ¡</button>
                    <button class="option-btn" onclick="showHome()">è¿”å›é¦–é¡µ</button>
                </div>
            `;
        }

        function showNewQuote() {
            const savedMbtiType = localStorage.getItem('mbtiType') || '';
            const quote = getRandomQuote(savedMbtiType);
            const quoteText = document.querySelector('.quote-text');
            quoteText.textContent = `"${quote}"`;
        }

        function showResult() {
            const result = calculateResult();
            localStorage.setItem('mbtiType', result);
            const container = document.getElementById('main-container');
            
            container.innerHTML = `
                <div class="result-container">
                    <h2>æµ‹è¯•ç»“æœ</h2>
                    <p>æ‚¨çš„MBTIç±»å‹æ˜¯: ${result}</p>
                    <button class="option-btn" onclick="restartTest()">é‡æ–°æµ‹è¯•</button>
                    <button class="option-btn" onclick="showQuoteSection()">æŸ¥çœ‹ä»Šæ—¥æ¿€åŠ±</button>
                </div>
            `;
        }

        function restartTest() {
            currentQuestionIndex = 0;
            answers = new Array(questions.length).fill('');
            showQuestion();
        }

        function showInputSection() {
            const container = document.getElementById('main-container');
            container.innerHTML = `
                <div class="input-section">
                    <h2>è¯·è¾“å…¥æ‚¨çš„MBTIç±»å‹</h2>
                    <input type="text" id="mbtiInput" placeholder="ä¾‹å¦‚ï¼šINTJ" maxlength="4" 
                           oninput="this.value = this.value.toUpperCase()" />
                    <p>è¯·è¾“å…¥4ä¸ªå­—æ¯çš„MBTIç±»å‹</p>
                    <button class="action-btn" onclick="saveMBTIType()">ç¡®è®¤</button>
                    <button class="option-btn" onclick="showHome()">è¿”å›</button>
                </div>
            `;
        }

        function saveMBTIType() {
            const mbtiInput = document.getElementById('mbtiInput').value.toUpperCase();
            const validMBTI = /^[EI][NS][TF][JP]$/;
            
            if (!validMBTI.test(mbtiInput)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„MBTIç±»å‹ï¼\nç¬¬ä¸€ä½ï¼šEæˆ–I\nç¬¬äºŒä½ï¼šNæˆ–S\nç¬¬ä¸‰ä½ï¼šTæˆ–F\nç¬¬å››ä½ï¼šJæˆ–P');
                return;
            }

            localStorage.setItem('mbtiType', mbtiInput);
            showQuoteSection();
        }

        function showHome() {
            const container = document.getElementById('main-container');
            container.innerHTML = `
                <div class="action-buttons">
                    <button class="action-btn" onclick="showInputSection()">å·²çŸ¥MBTIç±»å‹</button>
                    <button class="action-btn" onclick="showTestSection()">å¼€å§‹MBTIæµ‹è¯•</button>
                </div>
            `;
        }

        const savedMbtiType = localStorage.getItem('mbtiType');
        if (savedMbtiType) {
            showQuoteSection();
        } else {
            showHome();
        }

        // èŠå¤©ç›¸å…³å‡½æ•°
        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            const isFirstOpen = chatContainer.style.display === 'none' && !chatContainer.dataset.opened;
            chatContainer.style.display = chatContainer.style.display === 'none' ? 'flex' : 'none';
            
            if (isFirstOpen) {
                chatContainer.dataset.opened = 'true';
                const savedMbtiType = localStorage.getItem('mbtiType');
                const welcomeMessage = savedMbtiType 
                    ? `æ¬¢è¿å›æ¥ï¼ä½œä¸ºä¸€ä¸ª ${savedMbtiType} ç±»å‹çš„äººï¼Œæˆ‘å¾ˆé«˜å…´èƒ½å’Œä½ äº¤æµã€‚` 
                    : 'ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ã€‚';
                addMessage(welcomeMessage, 'bot');
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (message) {
                addMessage(message, 'user');
                input.value = '';
                
                try {
                    const response = await fetch('http://localhost:3000/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: message,
                            mbtiType: localStorage.getItem('mbtiType') || '',
                            context: getConversationHistory()
                        })
                    });
                    
                    const data = await response.json();
                    document.getElementById('aiAssistantName').textContent = 
                        `AI åŠ©æ‰‹ - ${data.aiName}`;
                    addMessage(data.response, 'bot');
                    saveConversation();
                } catch (error) {
                    addMessage('æŠ±æ­‰ï¼Œå‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚', 'bot');
                }
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function addMessage(text, sender, typing = true) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            if (sender === 'bot' && typing) {
                let i = 0;
                messageDiv.textContent = '';
                const interval = setInterval(() => {
                    messageDiv.textContent += text[i];
                    i++;
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    if (i >= text.length) clearInterval(interval);
                }, 30);
            } else {
                messageDiv.textContent = text;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function toggleVoiceInput() {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.lang = 'zh-CN';
                recognition.continuous = false;
                recognition.interimResults = false;

                const voiceButton = document.querySelector('[title="è¯­éŸ³è¾“å…¥"]');
                
                recognition.onstart = () => {
                    voiceButton.classList.add('recording');
                };

                recognition.onend = () => {
                    voiceButton.classList.remove('recording');
                };

                recognition.onresult = (event) => {
                    const text = event.results[0][0].transcript;
                    document.getElementById('chatInput').value = text;
                    sendMessage();
                };

                recognition.start();
            } else {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥åŠŸèƒ½');
            }
        }

        function uploadFile() {
            document.getElementById('fileInput').click();
        }

        function uploadImage() {
            document.getElementById('imageInput').click();
        }

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const formData = new FormData();
                formData.append('file', file);
                
                addMessage(`æ­£åœ¨å¤„ç†æ–‡ä»¶: ${file.name}`, 'user');
                try {
                    const response = await fetch('http://localhost:3000/api/upload/file', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await response.json();
                    addMessage(data.response, 'bot');
                    saveConversation();
                } catch (error) {
                    addMessage('æ–‡ä»¶å¤„ç†å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚', 'bot');
                }
            }
        }

        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                    return;
                }

                const reader = new FileReader();
                reader.onload = async (e) => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message user-message';
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    messageDiv.appendChild(img);
                    document.getElementById('chatMessages').appendChild(messageDiv);

                    try {
                        const formData = new FormData();
                        formData.append('image', file);
                        const response = await fetch('http://localhost:3000/api/upload/image', {
                            method: 'POST',
                            body: formData
                        });
                        const data = await response.json();
                        addMessage(data.response, 'bot');
                        saveConversation();
                    } catch (error) {
                        addMessage('å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚', 'bot');
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // æ·»åŠ å¯¹è¯å†å²è®°å½•ç›¸å…³å‡½æ•°
        function getConversationHistory() {
            const messages = document.querySelectorAll('.message');
            return Array.from(messages).map(msg => ({
                role: msg.classList.contains('user-message') ? 'user' : 'assistant',
                content: msg.textContent
            }));
        }

        function saveConversation() {
            const history = getConversationHistory();
            localStorage.setItem('chatHistory', JSON.stringify(history));
        }

        function loadConversation() {
            const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            history.forEach(msg => {
                addMessage(msg.content, msg.role === 'user' ? 'user' : 'bot', false);
            });
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–èŠå¤©å†å²
        document.addEventListener('DOMContentLoaded', () => {
            loadConversation();
        });
    </script>
</body>
</html> 